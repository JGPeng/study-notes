# 性能优化

#### 什么是性能？

就前端而言，从网站开始生成开始，到代码开始运行，期间消耗浏览器以及服务器的一切资源统称为性能。

### 为什么要做性能优化？

使网站运行速度更快，给用户带来更好的体验，防止造成用户流失。

### 如何优化性能？

##### 浏览器的缓存策略

1. 强缓存
    + 强缓存是利用http头中的Expires和Cache-Control两个字段来控制的，用来表示资源的缓存时间。强缓存中，普通刷新会忽略它，但不会清除它，需要强制刷新。浏览器强制刷新，请求会带上Cache-Control:no-cache和Pragma:no-cache
    + Cache-Control
        + public 表示响应可以被客户端和代理服务器缓存
        + private 表示响应只可以被客户端缓存
        + max-age=30 缓存30秒后过期，需要重新请求
        + s-maxage=30 覆盖max-age，作用一样，只在代理服务器中生效
        + no-store 不缓存任何响应
        + no-cache 资源被缓存，但是立即失效，下次会发起请求验证资源是否过期
        + max-stale=30 30秒内，即使缓存过期，也使用该缓存
        + min-fresh=30 希望在30秒内获取最新的响应
    + Expires
        + 缓存过期时间，用来指定资源到期的时间，是服务器端的具体的时间点。也就是说，Expires=max-age + 请求时间，需要和Last-modified结合使用。Expires是Web服务器响应消息头字段，在响应http请求时告诉客户端其在过期时间前浏览器可以直接从浏览器缓存取数据，二无需再次请求。
    + 强缓存的两个状态： 
        + from memory cache
        + from disk cache
    + 特征；
        1. 请求码为200
        2. Size大小为(memory cache)或(disk cache)
        3. Time为0ms
2. 协商缓存 
    + 协商缓存就是由服务器来确定缓存资源是否可用，所以客户端与服务器端要通过某种标识来进行通信，从而让服务器判断请求资源是否可以缓存访问。
    + 缓存生效：http状态码304
    + 缓存不生效：http状态码200，走正常从服务端获取资源
3. 我的理解
    + 强缓存：第一次进入页面请求时根据 response Header 来判断是否对资源进行缓存，如果响应头中有 Expires 或 Cache-Control 字段则表示为强缓存，浏览器会把资源缓存在 memory cache 或 disk cache 中。第二次请求时会先判断缓存资源是否过期，没过期则返回缓存资源和状态码200，过期则判断是否符合协商缓存，若符合就返回304，不符合则服务器返回全新资源和状态码200。
    + 协商缓存：当强缓存失效后，浏览器携带缓存标识向服务器发送请求，由服务器根据缓存表示来决定是否使用缓存。
        + If-Modified-Since：把浏览器端缓存页面的最后修改时间发送到服务器去，服务器会把这个时间与服务器上实际文件的最后修改时间进行对比。如果时间一致，那么返回304，客户端就直接使用本地缓存文件。如果时间不一致，就会返回200和新的文件内容。客户端接到之后，会丢弃旧文件，把新文件缓存起来，并显示在浏览器中。
        + If-None-Match：If-None-Match和ETag一起工作，工作原理是在HTTP Response中添加ETag信息。当用户再次请求该资源时，将在 HTTP Request 中加入 If-None-Match 信息(即上一次服务器返回的ETag值)。如果服务器验证资源的ETag没有改变（该资源没有更新），将返回一个304状态告诉客户端使用本地缓存文件。否则将返回200状态和新的资源和Etag。使用这样的机制将提高网站的性能

##### 精炼js代码

1. 算法
    + 时间复杂度
    + 空间复杂度

##### 静态资源的加载

1. cdn
2. 雪碧图